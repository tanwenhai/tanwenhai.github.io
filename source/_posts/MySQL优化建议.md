---
title: MySQL优化建议
date: 2018-03-12 10:56:48
tags:
---

# 字段
* 尽量使用 TINYINT、 SMALLINT、 MEDIUM_INT作为整数类型而非 INT，如果非负则加上 UNSIGNED
* VARCHAR的长度只分配真正需要的空间 VARCHAR长度过长会分开存储 [MySQL 如何存储长度较大的varchar与blob](https://github.com/zhangyachen/zhangyachen.github.io/issues/96)
* 使用枚举或整数代替字符串类型
* 单表不要有太多字段，建议在20以内，主表不存储大字段
* 避免使用NULL字段，很难查询优化且占用额外索引空间，还会引入三值逻辑带来的一些意想不到的情况

# 索引
* 索引并不是越多越好，要根据查询有针对性的创建，考虑在 WHERE和 ORDER BY命令上涉及的列建立索引，可根据 EXPLAIN来查看是否用了索引还是全表扫描
* 应尽量避免在 WHERE子句中对字段进行 NULL值判断，否则将导致引擎放弃使用索引而进行全表扫描
* 值分布很稀少的字段不适合建索引，例如"性别"这种只有两三个值的字段
* 字符字段只建前缀索引
* 字符字段最好不要做主键
* 不用外键，由程序保证约束
* 使用多列索引时主意顺序和查询条件保持一致，同时删除不必要的单列索引

# 查询SQL
* 不做列运算： SELECT id WHERE age+1=10，任何对列的操作都将导致表扫描，它包括数据库教程函数、计算表达式等等，查询时要尽可能将操作移至等号右边
* 列表数据不要拿全表，要使用 LIMIT来分页，每页数量也不要太大
* 使用同类型进行比较，比如用 '123'和 '123'比， 123和 123比 避免类型不一致导致不走索引
* 避免like查询，可以右模糊 比如like xxx% 
* 尽量避免在 WHERE子句中使用!=或<>操作符，否则将引擎放弃使用索引而进行全表扫描
* 使用not exists 代替 not in 
